# DailyDisplay

> 自定义一个信息显示窗口，自定义信息和轻量自动化控制 
> 程序使用豆包和TRAE编写，感谢豆包和TRAE，感谢豆包和TRAE，感谢豆包和TRAE

我们的主页：https://github.com/iqonli/iqonli

本项目使用[GNU Lesser General Public License v3](LICENSE) 许可证。

## 重要提示

**本地的`config.txt`文件必须为ANSI编码！**
0.x版本为测试版，定义为“能用，但某些功能有缺陷”，欢迎支持错误！

## 介绍

  DailyDisplay是一款Windows API的轻量级显示工具，支持以下核心能力：

  - 实时显示时间、日期、自定义文本
  - 配置定时关机计划（含提前提示）
  - 调用外部程序并展示其返回结果（如系统命令、自定义脚本输出）
  - 通过配置文件灵活定制窗口样式（位置、大小、透明度、置顶等）
  - 支持按周期循环显示内容（按日/周/月/年）
  - 自动识别配置文件修改并实时更新显示效果

## 工作方式

  程序启动后遵循以下核心逻辑，确保功能稳定与灵活：

  1. **配置读取**：启动时优先读取同目录下的`config.txt`文件（**必须为ANSI本地编码**，否则可能乱码）。
  2. **窗口创建**：根据配置文件规则生成信息显示窗口，默认行为如下：
     - 主程序（控制台）：隐藏任务栏图标与Alt+Tab列表，仅在系统托盘显示。
     - 信息显示窗口：隐藏任务栏图标，显示在Alt+Tab列表，不最小化到托盘。
     - 定时关机窗口：独立普通窗口，支持关闭/取消操作。
  3. **实时刷新机制**：
     - 时间信息：每50ms刷新一次（确保秒级/毫秒级显示精准）。
     - 配置文件：每500ms重新读取一次，若检测到修改，自动销毁当前窗口并重建（无需重启程序）。
  4. **托盘交互**：系统托盘菜单提供核心操作：
     - 显示/隐藏信息窗口
     - 退出程序

## 配置文件规则  

  `config.txt`是程序的核心配置载体，所有自定义逻辑均通过该文件实现，需严格遵循以下规则：

  ### 基本语法

  - 每行对应显示窗口中的一行内容，空行将在显示窗口中保留空白行。
  - 特殊值用`[]`标记，分为**含参特殊值**（如`[start]{参数}`）和**无参特殊值**（如`[yyyy]`）。
  - 含参特殊值的语法要求：
    - 大括号`{}`必须紧跟`[]`后，中间**不允许空格**（如`[style] {123}`错误，`[style]{123}`正确），否则触发参数缺失错误。
    - 右大括号`}`可在任意位置（允许参数跨多行，但建议紧凑排版）。
    - 括号内多个参数用**逗号`,`分隔**，参数间允许空格/换行，支持空值（如`{1,,3}`表示第二个参数为空）。
    - 字符串参数：语法与 C++ 一致，支持转义字符（如 \" 表示双引号，\\ 表示反斜杠）。
    - 转义嵌套：最多支持**1层嵌套**，内层引号必须转义（示例：`[style]{20,0,0,0,"[h]:[m]:[s] [to,030000,060000]{\"凌晨\",}"}`）。
    - 单行限制：单个特殊值或单个字符串的定义**不可跨行**。
    - 特殊转义：仅在`[line]`特殊值的大括号内，若需显示`{`或`}`，需用`\{`和`\}`转义（其他场景无需此操作）。

  ### 特殊值位置规则

  - 特殊值必须位于行首或字符串开头。
  - 注释语法：空中括号`[]`表示该行是注释，**必须位于行首**。
  - 特殊值详解

  特殊值是配置文件的核心，按功能分为窗口配置类、时间日期类、功能类三类，以下是完整说明：

  ### 窗口配置类

  用于定义显示窗口的基础样式，全局生效（部分可被行内样式覆盖）。

  #### [start]（含参，全局唯一）

  **功能**：设置程序启动时的窗口属性，整个配置文件中**仅允许出现 1 次**，重复会触发错误。
  **格式**：`[start]{x坐标,y坐标,宽度,高度,透明度,鼠标穿透,任务栏隐藏,Alt+Tab隐藏,部分置顶,完全置顶,显示最小化按钮,显示最大化按钮,显示关闭按钮,显示标题栏,启动最大化,启动最小化,最小化到托盘,自动刷新置顶时间,窗口标题}`
  **参数说明**：

  | 参数序号 | 参数名称          | 类型   | 取值范围 |
  | -------- | ----------------- | ------ | -------- |
  | 1        | 窗口左上角 X 坐标 | 整数   | ≥0       |
  | 2        | 窗口左上角 Y 坐标 | 整数   | ≥0       |
  | 3        | 窗口宽度          | 整数   | ≥0       |
  | 4        | 窗口高度          | 整数   | ≥0       |
  | 5        | 窗口透明度        | 整数   | 0~255    |
  | 6        | 鼠标穿透          | 布尔   | 0/1      |
  | 7        | 任务栏隐藏窗口    | 布尔   | 0/1      |
  | 8        | Alt+Tab 隐藏窗口  | 布尔   | 0/1      |
  | 9        | 部分置顶          | 布尔   | 0/1      |
  | 10       | 完全置顶          | 布尔   | 0/1      |
  | 11       | 显示最小化按钮    | 布尔   | 0/1      |
  | 12       | 显示最大化按钮    | 布尔   | 0/1      |
  | 13       | 显示关闭按钮      | 布尔   | 0/1      |
  | 14       | 显示标题栏        | 布尔   | 0/1      |
  | 15       | 启动时最大化      | 布尔   | 0/1      |
  | 16       | 启动时最小化      | 布尔   | 0/1      |
  | 17       | 最小化到托盘      | 布尔   | 0/1      |
  | 18       | 自动刷新置顶时间  | 整数   | -1/≥0    |
  | 19       | 启动窗口标题      | 字符串 | 任意文本 |

  #### [backcolor]（含参，全局背景）

  **功能**：定义整个显示窗口的背景颜色。
  **格式**：`[backcolor]{R,G,B}`
  **参数说明**：

  - R/G/B：分别为红色、绿色、蓝色通道值，取值范围0~255（如`{0,0,0}`为黑色，`{255,255,255}`为白色）。

  #### [font]（含参，全局默认字体）

  **功能**：定义窗口内所有文本的默认字体样式（可被`[style]`覆盖）。
  **格式**：`[font]{字号,字色R,字色G,字色B,上间距,左间距,右间距,字体名称}`
  **参数说明**：
  - 字号：整数；
  - 字色 R/G/B：文本颜色的三通道值（0~255）；
  - 上/左/右间距：窗口边缘与文本的距离（整数，单位：px）；
  - 字体名称：字符串；
  - 行间距：程序根据字号自动计算，无需手动配置。

  #### [style]（含参，行内样式）

  **功能**：为某一行文本单独设置字体样式，覆盖全局`[font]`配置。
  **格式**：`[style]{字号,字色R,字色G,字色B,字体名称,显示文本}`
  **参数说明**：  
  - 前5个参数（字号、字色、字体名称）与`[font]`一致；  
  - 显示文本：需显示的内容。

  ### 时间日期类

  用于显示实时时间、日期，或计算时间/日期差，支持条件显示。

  #### 无参时间特殊值

  直接替换为当前对应的时间/日期信息，无需额外参数，允许不出现在行首：

| 特殊值 | 功能说明                      | 示例输出 |
| ------ | ----------------------------- | -------- |
| [yyyy] | 当前年份（4 位）              | 2025     |
| [mm]   | 当前月份（1 位/2 位，不补零） | 1、12    |
| [0m]   | 当前月份（2 位，补零）        | 01、12   |
| [dd]   | 当前日期（1 位/2 位，不补零） | 1、31    |
| [0d]   | 当前日期（2 位，补零）        | 01、31   |
| [h]    | 当前小时（24 小时制，不补零） | 1、13    |
| [0h]   | 当前小时（24 小时制，补零）   | 01、13   |
| [h12]  | 当前小时（12 小时制，不补零） | 1、1     |
| [0h12] | 当前小时（12 小时制，补零）   | 01、01   |
| [m]    | 当前分钟（2 位，补零）        | 01、59   |
| [s]    | 当前秒钟（2 位，补零）        | 01、59   |
| [ms]   | 当前毫秒（3位，补零）         | 001、999 |

  #### [to,time1,time2]（含参，时间范围条件显示）

  **功能**：根据当前时间是否在time1~time2范围内，显示不同内容。  
  **格式**：`[to,time1,time2]{"范围内文本","范围外文本"}` 
  **参数说明**：

  - time1/time2：6位数字时间（HHMMSS）；
  - 范围内文本：当前时间在time1~time2时显示的内容；
  - 范围外文本：当前时间不在time1~time2时显示的内容；
  - 两个参数都可空，为空则不显示该行。

  #### [周期类型,n,起始日期]（含参，周期循环显示）

  **功能**：按日/周/月/年周期循环显示内容，仅在符合条件的日期显示对应文本。
  **格式**：`[day/week/month/year,n,YYYYMMDD]{"内容1","内容2",..."内容N"}`
  **参数说明**：
  - 周期类型：day、week、month、year；
  - n：周期长度（每n个单位循环一次，如day,2表示每2天循环）；
  - 起始日期：8位数字（YYYYMMDD）；
  - 内容列表：用逗号分隔的字符串，数量需与周期匹配。
    **显示规则**：
    1. 当前日期在起始日期之前：该行不显示；
    2. 符合周期条件时：显示对应内容（即使内容为空，也会保留该行空白）；
    3. 不符合周期条件时：整行不显示。

  #### [disdate]（含参，日期距离计算）

  **功能**：计算当前日期与目标日期的差值，并按自定义格式显示。
  **格式**：`[disdate,目标日期,显示负数,显示绝对值]{待转译文本}`
  **参数说明**：
  - 目标日期：8 位数字（YYYYMMDD），支持通配符（如`00000501`表示每年5月1日”，`20250001`表示2025年每月1日）；
  - 显示负数：0/1，1=允许显示负差值（当前日期晚于目标日期时）；
  - 显示绝对值：0/1，1=差值取绝对值（若与“显示负数”同时为1，优先显示负数）；
  - 待转译文本：包含差值标记的文本，标记说明如下：

  | 标记   | 功能说明                     | 示例输出（目标 20250501，当前 20250401） |
  | ------ | ---------------------------- | ---------------------------------------- |
  | [dy]   | 总差值（年，整数）           | 0                                        |
  | [dmo]  | 总差值（月，整数）           | 1                                        |
  | [dd]   | 总差值（日，整数）           | 0                                        |
  | [sdy]  | 差值（年，3 位小数，去尾零） | 0.083（1 个月≈0.083 年）                 |
  | [sdmo] | 差值（月，3 位小数，去尾零） | 1.0（刚好 1 个月）                       |
  | [sdd]  | 差值（日，整数）             | 30                                       |

  **说明**：若当前日期晚于目标日期，且显示负数、显示绝对值均为0，则该行不显示。
  **示例**：  
  `[disdate,20251001,0,1]{距离国庆还有[sdd]天}`
  （当前日期在20251001之前时，显示“距离国庆还有XX天”；之后显示“距离国庆还有XX天”（绝对值））

  #### [distime]（含参，当天时间距离计算）

  **功能**：计算当前时间与目标时间的差值（仅当天内），支持显示次日目标时间。
  **格式**：`[distime,目标时间,显示负数,显示明天时间]{待转译文本}`
  **参数说明**：
  - 目标时间：6位数字（HHMMSS）；
  - 显示负数：0/1，1=允许显示负差值（当前时间晚于目标时间时）；
  - 显示明天时间：0/1，1=当前时间晚于目标时间时，计算与次日目标时间的差值；
  - 待转译文本：包含差值标记的文本，标记说明如下：

  | 标记   | 功能说明                     | 示例输出（目标 180000，当前 163000） |
  | ------ | ---------------------------- | ------------------------------------ |
  | [dh]   | 总差值（时，整数）           | 1                                    |
  | [dmi]  | 总差值（分，整数）           | 30                                   |
  | [ds]   | 总差值（秒，整数）           | 0                                    |
  | [sdh]  | 差值（时，3 位小数，去尾零） | 1.5（1.5 小时）                      |
  | [sdmi] | 差值（分，3 位小数，去尾零） | 90.0（90 分钟）                      |
  | [sds]  | 差值（秒，整数）             | 5400                                 |

  **说明**：若当前时间晚于目标时间，且显示负数、显示明天时间均为0，则该行不显示；每天 00:00自动刷新计算逻辑。
  **示例**：
  `[distime,233000,0,1]{距离睡觉还有[dh]小时[dmi]分钟}`
  （当前时间早于23:30时显示剩余时间；晚于23:30时，显示“距离睡觉还有24-(当前时间-23:30)小时”）

  #### [disdatetime]（含参，日期时间距离计算）

  **功能**：计算当前日期时间与目标日期时间的总差值（跨天/跨月/跨年），是`[disdate]`与`[distime]`的结合。  
  **格式**：`[disdatetime,目标日期,目标时间,显示负数,显示绝对值]{待转译文本}`
  **参数说明**：
  - 目标日期：8 位数字（YYYYMMDD），目标时间：6 位数字（HHMMSS）；
  - 显示负数/显示绝对值：逻辑与`[disdate]`一致；
  - 待转译文本：支持`[disdate]`和`[distime]`的所有差值标记（如`[dy]`年、`[dh]`时）。  
    **示例**：
    `[disdatetime,20260101,000000,0,1]{距离2026年还有[dy]年[dmo]月[dd]天[dh]小时}`

  ### 功能类

  提供定时关机、外部程序调用、文本处理等扩展功能。

  ### [shutdown]（含参，定时关机计划）

  **功能**：设置自动关机任务，含提前弹窗提示（弹窗的第一行为`还剩[rest]秒关机，点击窗口或关闭窗口来取消关机`））。
  **格式**：`[shutdown]{目标时间,提前提示秒数,"提示文本"}`
  **参数说明**：
  - 目标时间：6位数字（HHMMSS机）；
  - 提前提示秒数：整数（如60表示关机前60秒弹窗）；
  - 提示文本：弹窗显示的第二行往后的内容，可包含`[rest]`标记（自动替换为剩余关机秒数），该特殊值仅允许在“提示文本”中使用。
    **功能逻辑**：
    1. 到达“目标时间-提前提示秒数”时，弹出置顶提示窗口；
    2. 点击窗口任意位置或关闭按钮：取消当前关机计划（往后的计划不受影响）；
    3. 超时未操作（提示秒数结束）：自动执行关机。
    **示例**：
    `[shutdown]{233000,60,"休息时间到！还剩[rest]秒自动关机"}`
    （23:29弹窗提示，显示剩余秒数，点击窗口取消关机）

  ### [shutdowntext]（无参，关机文本模板）

  **功能**：关机提示文本的标准转义，在主窗口或关机提示窗口使用。
  **替换逻辑**：自动转为`将在h:m:s关机，还剩[x小时(若有)][x分钟(若有)][x秒(若有)]`。
  **示例**：

  ### [rest]（无参，剩余关机时间标记）

  **功能**：仅在`[shutdown]`的提示文本中生效，自动替换为 “当前距离关机的剩余秒数”（动态更新）。
  **示例**：见`[shutdown]`示例。

  ### [refresh]（含参，刷新频率配置）

  **功能**：自定义程序的核心刷新频率，覆盖默认值（默认：时间刷新50ms、配置读取500ms、关机窗口置顶500ms）。  
  **格式**：`[refresh]{时间刷新间隔,配置读取间隔,关机窗口置顶刷新间隔}`
  **参数说明**：
  - 三个参数均为整数（单位：ms），若为空或格式错误，自动使用默认值；
  - 建议：时间刷新间隔≥50ms（避免占用过多CPU），配置读取间隔≥500ms（避免频繁读取文件）。
    **示例**：
    [refresh]{100,1000,500}
    （每100ms刷新时间、每1秒读取配置、每500ms刷新关机窗口置顶状态）

  ### [line]（含参，文本换行处理）

  **功能**：将多行内容中的任意换行符删除，将多行内容合并为一行显示。
  **格式**：`[line]{"文本内容（可跨多行）"}`
  **特殊规则**：若需在文本中显示`{`或`}`，需用`\{`和`\}`转义（仅在`[line]`内生效）。

  ### [app]（含参，外部程序调用）

  **功能**：后台调用本地程序/命令，获取其输出结果并在窗口中显示（保留原始换行格式）。  
  **格式**：`[app]{"程序路径及参数",刷新间隔毫秒数}`
  **参数说明**：
  - 程序路径及参数：字符串（如"ipconfig"调用系统命令，"D:\\test.exe -a"调用自定义程序并传参）；
  - 刷新间隔：整数（单位：ms），-1=仅调用1次（程序启动时），或者填每N毫秒重新调用并更新结果。
    **说明**：若程序无输出，则显示空行；需确保程序路径正确（cmd命令可直接写名称，如`ping http://127.0.0.1/ -n 1`）。

  ### [appline]（含参，外部程序调用，合并换行）

  **功能**：与`[app]`一致，但将程序输出的换行符替换为指定字符串。  
  **格式**：`[appline]{"程序路径及参数","换行替换符",刷新间隔毫秒数}`
  **参数说明**：
  - 换行替换符：字符串，不填默认替换为空格；  
  - 其他参数与`[app]`一致。

有事没事请加QQ群：743278470，你可以添加句子，报告错误，寻求帮助